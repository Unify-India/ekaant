<ion-card class="registration-section-card">
  <h2>{{ pageTitle }}</h2>
  <p>{{ subTitle }}</p>

  @if (seatManagementForm.invalid && seatManagementForm.touched) {
    <div class="warning-glass-box ion-margin-bottom">
      <ion-icon name="warning-outline"></ion-icon>
      <ion-note>{{ completionWarning }}</ion-note>
    </div>
  }

  <form [formGroup]="seatManagementForm">
    <div class="outlined-box">
      <p class="description">{{ seatManagementDescription }}</p>

      <div class="total-seats-control">
        <ion-label>{{ totalSeatsLabel }}</ion-label>
        <div class="seat-counter">
          <ion-button (click)="decrementSeats()" [disabled]="totalSeats() <= 0" fill="clear" color="danger">
            <ion-icon name="remove-outline" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-input type="number" formControlName="totalSeats"></ion-input>
          <ion-button (click)="incrementSeats()" color="success" fill="clear">
            <ion-icon name="add-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>
      @if (totalSeats() > 0) {
        <ion-note>{{ seatsHelperText(totalSeats()) }}</ion-note>
      }
    </div>

    @if (totalSeats() > 0) {
      <div class="outlined-box">
        <div class="facility-range-header">
          <div class="facility-range-title">
            <h4>{{ facilityRangesTitle }}</h4>
            <p class="description">{{ facilityRangesDescription }}</p>
          </div>
          <ion-button fill="clear">
            <ion-icon slot="icon-only" name="add-circle-outline"></ion-icon>
          </ion-button>
        </div>

        <div formArrayName="facilityRanges">
          @for (rangeGroup of facilityRanges.controls; track rangeGroup; let i = $index) {
            <div [formGroupName]="i" class="assigned-range-display">
              <span>
                <ion-icon name="checkmark-circle" class="success"></ion-icon>
                Seats {{ rangeGroup.get('from')?.value }} to {{ rangeGroup.get('to')?.value }}:
                {{ getFacilityLabel(rangeGroup.get('facility')?.value) }}
              </span>
              <ion-buttons>
                <ion-button fill="clear" color="medium">
                  <ion-icon name="create-outline"></ion-icon>
                </ion-button>
                <ion-button fill="clear" color="danger" (click)="removeFacilityRange(i)">
                  <ion-icon name="trash-outline"></ion-icon>
                </ion-button>
              </ion-buttons>
            </div>
          }
        </div>

        <div [formGroup]="newRangeForm" class="ion-margin-top">
          <div class="range-row">
            <div class="inline-flex">
              <ion-input
                type="number"
                label="From"
                fill="outline"
                labelPlacement="stacked"
                formControlName="from"
                [max]="totalSeats()"
              ></ion-input>

              <ion-input
                type="number"
                label="To"
                fill="outline"
                labelPlacement="stacked"
                formControlName="to"
                [min]="newRangeForm.get('from')?.value"
                [max]="totalSeats()"
              ></ion-input>
            </div>

            <div class="inline-flex">
              <ion-select
                label="Facilities"
                labelPlacement="stacked"
                fill="outline"
                placeholder="Select"
                formControlName="facility"
                multiple
              >
                @for (option of facilityOptions; track option.value) {
                  <ion-select-option [value]="option.value">{{ option.label }}</ion-select-option>
                }
              </ion-select>

              <ion-button (click)="addFacilityRange()" fill="solid" color="success" [disabled]="newRangeForm.invalid">
                <ion-icon slot="start" name="save-outline"></ion-icon>
                Save Facility
              </ion-button>
            </div>
          </div>
        </div>
      </div>
    }

    @if (totalSeats() > 0) {
      <div class="outlined-box">
        <h4>{{ individualSeatConfigTitle }}</h4>
        <p class="description">{{ individualSeatConfigDescription }}</p>
        <div class="seat-grid">
          @for (seatNum of seatNumbers(); track seatNum) {
            <ion-button
              (click)="selectIndividualSeat(seatNum)"
              [class.selected]="selectedIndividualSeat() === seatNum"
              [class.has-config]="hasSeatConfig(seatNum)"
              color="light"
            >
              <ion-icon
                [name]="hasSeatConfig(seatNum) ? 'checkmark-circle' : 'cog-outline'"
                [color]="hasSeatConfig(seatNum) ? 'success' : 'primary'"
              ></ion-icon>
              {{ seatNum }}
            </ion-button>
          }
        </div>
      </div>
    }
  </form>
</ion-card>
