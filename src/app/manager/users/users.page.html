<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Users</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="onboardUser()" color="success">
        <ion-icon slot="start" name="person-add-outline"></ion-icon>
        Onboard
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Users</ion-title>
    </ion-toolbar>
  </ion-header>

  @if (isLoading) {
    <div class="ion-text-center ion-padding">
      <ion-spinner></ion-spinner>
      <p>Loading users...</p>
    </div>
  } @else {
    <ion-card class="table-card">
      <div class="table-container">
        <ion-grid class="data-grid">
          <!-- Header Row -->
          <ion-row class="grid-header">
            <ion-col size="2" class="ion-text-center">Actions</ion-col>
            <ion-col size="2">Name</ion-col>
            <ion-col size="3">Email</ion-col>
            <ion-col size="2">Role</ion-col>
            <ion-col size="2">Join Date</ion-col>
            <ion-col size="1" class="ion-text-center">Status</ion-col>
          </ion-row>

          <!-- Data Rows -->
          @if (users.length > 0) {
            @for (user of users; track user.uid) {
              <ion-row class="grid-row">
                <ion-col size="2" class="action-buttons ion-text-center">
                  <ion-button fill="clear" size="small" (click)="viewUser(user)" title="View">
                    <ion-icon slot="icon-only" name="eye-outline" color="primary"></ion-icon>
                  </ion-button>
                  <ion-button fill="clear" size="small" (click)="editUser(user)" title="Edit">
                    <ion-icon slot="icon-only" name="create-outline" color="secondary"></ion-icon>
                  </ion-button>
                </ion-col>
                <ion-col size="2">
                  <div class="user-info">
                    <span>{{ user.displayName || 'N/A' }}</span>
                  </div>
                </ion-col>
                <ion-col size="3">{{ user.email }}</ion-col>
                <ion-col size="2">
                  <ion-chip outline color="tertiary" class="role-chip">
                    <ion-label>{{ user.role | titlecase }}</ion-label>
                  </ion-chip>
                </ion-col>
                <ion-col size="2">{{ toDate(user.createdAt) | date: 'mediumDate' }}</ion-col>
                <ion-col size="1" class="ion-text-center">
                  <ion-badge [color]="getStatusColor(user.status)">
                    {{ user.status | titlecase }}
                  </ion-badge>
                </ion-col>
              </ion-row>
            }
          } @else {
            <ion-row>
              <ion-col size="12" class="ion-text-center">
                <ion-text color="medium">
                  <p>No users found for this library.</p>
                </ion-text>
              </ion-col>
            </ion-row>
          }
        </ion-grid>
      </div>
    </ion-card>
  }
</ion-content>
