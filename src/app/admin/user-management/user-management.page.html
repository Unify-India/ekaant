<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>User Management</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  @if (isAdmin$ | async) {
    <div class="page-header">
      <div class="header-actions">
        <ion-button color="success" (click)="exportCsv()">
          <ion-icon slot="start" name="cloud-download-outline"></ion-icon>
          Export CSV
        </ion-button>
        <ion-button color="primary" (click)="addNewUser()">
          <ion-icon slot="start" name="add-outline"></ion-icon>
          Add New
        </ion-button>
      </div>
    </div>

    <ion-card class="table-card">
      <div class="table-container">
        @if (users$ | async; as users) {
          <ion-grid class="data-grid">
            <!-- Header Row -->
            <ion-row class="grid-header">
              <ion-col size="1.5" class="ion-text-center">Actions</ion-col>
              <ion-col size="2">Name</ion-col>
              <ion-col size="3">Email</ion-col>
              <ion-col size="2">Role</ion-col>
              <ion-col size="1.5" class="ion-text-center">Verified</ion-col>
              <ion-col size="2">Status</ion-col>
            </ion-row>

            <!-- Data Rows -->
            @if (users.length > 0) {
              @for (user of users; track user.uid) {
                <ion-row class="grid-row">
                  <ion-col size="1.5" class="action-buttons ion-text-center">
                    <ion-button fill="clear" size="small" (click)="viewUser(user.uid)">
                      <ion-icon slot="icon-only" name="eye-outline" color="success"></ion-icon>
                    </ion-button>
                    <ion-button fill="clear" size="small" (click)="editUser(user.uid)">
                      <ion-icon slot="icon-only" name="create-outline" color="primary"></ion-icon>
                    </ion-button>
                    <ion-button fill="clear" size="small" (click)="deleteUser(user.uid)">
                      <ion-icon slot="icon-only" name="trash-outline" color="danger"></ion-icon>
                    </ion-button>
                  </ion-col>
                  <ion-col size="2">{{ user.name }}</ion-col>
                  <ion-col size="3">{{ user.email }}</ion-col>
                  <ion-col size="2">{{ user.role | titlecase }}</ion-col>
                  <ion-col size="1.5" class="ion-text-center">
                    <ion-icon
                      [name]="user.verified ? 'checkmark-circle-outline' : 'close-circle-outline'"
                      [color]="user.verified ? 'success' : 'danger'"
                    ></ion-icon>
                  </ion-col>
                  <ion-col size="2">
                    <ion-chip [color]="user.verified ? 'success' : 'warning'">
                      {{ user.verified ? 'Active' : 'Pending' }}
                    </ion-chip>
                  </ion-col>
                </ion-row>
              }
            } @else {
              <div class="ion-text-center ion-padding">
                <p>No users found.</p>
              </div>
            }
          </ion-grid>
        } @else {
          <div class="ion-text-center ion-padding">
            <ion-spinner></ion-spinner>
            <p>Loading users...</p>
          </div>
        }
      </div>
    </ion-card>
  } @else {
    <div class="ion-text-center ion-padding">
      <p>You do not have permission to view this page.</p>
    </div>
  }
</ion-content>
