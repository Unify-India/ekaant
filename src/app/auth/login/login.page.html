<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>{{ pageTitle }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="auth-content">
  <div class="container ion-padding">
    <!-- Back Button -->
    @if (showAuthForm && selectedRole) {
      <ion-button fill="clear" (click)="resetRole()" class="back-button">
        <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
        Back
      </ion-button>
    }

    @if (!selectedRole) {
      <ion-button fill="clear" (click)="backToHome()" class="back-button">
        <ion-icon slot="start" name="home-outline"></ion-icon>
        Back to Home
      </ion-button>
    }

    <div class="auth-card">
      <!-- Role Selection Section -->
      @if (!showAuthForm) {
        <div class="header-section">
          <h1 class="welcome-title">Welcome Back!</h1>
          <p class="welcome-subtitle">Sign in to access your dashboard</p>
        </div>

        <div class="role-section">
          <h3 class="section-label">I am a...</h3>

          <div class="role-cards">
            <ion-card class="role-card" [class.selected]="selectedRole === 'student'" (click)="selectRole('student')">
              <ion-card-content>
                <ion-icon name="person-outline" class="role-icon"></ion-icon>
                <h3>Student</h3>
                <p>Access study spaces and resources</p>
              </ion-card-content>
            </ion-card>

            <ion-card class="role-card" [class.selected]="selectedRole === 'manager'" (click)="selectRole('manager')">
              <ion-card-content>
                <ion-icon name="people-outline" class="role-icon"></ion-icon>
                <h3>Manager</h3>
                <p>Manage library operations</p>
              </ion-card-content>
            </ion-card>
          </div>
        </div>

        <ion-button
          expand="block"
          size="large"
          (click)="proceedToAuthForm()"
          [disabled]="!selectedRole"
          class="continue-button"
        >
          Continue
          <ion-icon slot="end" name="arrow-forward"></ion-icon>
        </ion-button>
      }

      <!-- Login/Register Form Section -->
      @if (selectedRole && showAuthForm) {
        <div class="header-section">
          <h1 class="welcome-title">
            {{ isRegisterMode ? 'Create Your Account' : 'Welcome Back!' }}
          </h1>
          <p class="welcome-subtitle">
            {{ isRegisterMode ? 'Join Ekaant today' : 'Sign in to access your dashboard' }}
          </p>
          <div class="role-badge">
            <ion-chip color="primary">
              <ion-label>{{ selectedRole | titlecase }}</ion-label>
            </ion-chip>
          </div>
        </div>

        <form class="auth-form" (ngSubmit)="isRegisterMode ? register() : login()">
          <!-- Name Field (Register only) -->
          @if (isRegisterMode) {
            <ion-item class="form-item">
              <ion-input
                type="text"
                label="Full Name"
                labelPlacement="stacked"
                [(ngModel)]="name"
                name="name"
                placeholder="e.g., Priya Singh"
                required
              ></ion-input>
            </ion-item>
          }

          <!-- Email Field -->
          <ion-item class="form-item">
            <ion-input
              type="email"
              label="Email Address"
              labelPlacement="stacked"
              [(ngModel)]="email"
              name="email"
              placeholder="e.g., priya.singh@student.edu"
              required
            ></ion-input>
          </ion-item>

          <!-- Password Field -->
          <ion-item class="form-item">
            <ion-input
              type="password"
              label="Password"
              labelPlacement="stacked"
              [(ngModel)]="password"
              name="password"
              placeholder="Enter a password"
              required
            >
              <ion-input-password-toggle slot="end"></ion-input-password-toggle>
            </ion-input>
          </ion-item>

          <!-- Submit Button -->
          <ion-button type="submit" expand="block" size="large" [disabled]="isLoading" class="auth-button">
            @if (isLoading) {
              <ion-spinner></ion-spinner>
            }
            {{ isRegisterMode ? 'Create Account' : 'Sign In' }}
            @if (!isLoading) {
              <ion-icon slot="end" name="arrow-forward"></ion-icon>
            }
          </ion-button>
        </form>

        <!-- Social Login -->
        <div class="social-login">
          <div class="divider">
            <span>Or continue with</span>
          </div>

          <div class="social-buttons">
            <ion-button
              expand="block"
              fill="outline"
              color="medium"
              (click)="googleLogin()"
              [disabled]="isLoading"
              class="social-button"
            >
              <ion-icon slot="start" name="logo-google"></ion-icon>
              Google
            </ion-button>

            <ion-button
              expand="block"
              fill="outline"
              color="medium"
              (click)="facebookLogin()"
              [disabled]="isLoading"
              class="social-button"
            >
              <ion-icon slot="start" name="logo-facebook"></ion-icon>
              Facebook
            </ion-button>
          </div>
        </div>

        <!-- Toggle Auth Mode -->
        <div class="auth-toggle">
          <p>
            {{ isRegisterMode ? 'Already have an account?' : "Don't have an account?" }}
            <a (click)="toggleAuthMode()" class="toggle-link">
              {{ isRegisterMode ? 'Sign In' : 'Sign Up' }}
            </a>
          </p>
        </div>
      }
    </div>
  </div>
</ion-content>
